@using LrmCloud.Shared.DTOs.Translation

<RadzenCard Style="height: 100%; border: 1px solid var(--rz-base);">
    <RadzenStack Gap="0.5rem">
        <RadzenStack Orientation="Radzen.Orientation.Horizontal" JustifyContent="JustifyContent.SpaceBetween" AlignItems="Radzen.AlignItems.Start">
            <RadzenStack Orientation="Radzen.Orientation.Horizontal" AlignItems="Radzen.AlignItems.Center" Gap="0.5rem">
                <RadzenIcon Icon="@GetProviderIcon(Provider.Name)" />
                <RadzenStack Gap="0">
                    <RadzenText TextStyle="TextStyle.Subtitle1">@Provider.DisplayName</RadzenText>
                    @if (Provider.IsManagedProvider)
                    {
                        <RadzenBadge BadgeStyle="BadgeStyle.Warning" Text="Managed" Variant="Radzen.Variant.Filled" />
                    }
                    else if (!Provider.RequiresApiKey)
                    {
                        <RadzenBadge BadgeStyle="BadgeStyle.Success" Text="Free" Variant="Radzen.Variant.Outlined" />
                    }
                    else if (Provider.IsAiProvider)
                    {
                        <RadzenBadge BadgeStyle="BadgeStyle.Info" Text="AI" Variant="Radzen.Variant.Outlined" />
                    }
                </RadzenStack>
            </RadzenStack>

            @if (Provider.IsConfigured)
            {
                <RadzenIcon Icon="check_circle" Style="color: var(--rz-success); font-size: 1.25rem;" />
            }
        </RadzenStack>

        @if (!string.IsNullOrEmpty(Provider.Description))
        {
            <RadzenText TextStyle="TextStyle.Body2" class="rz-color-secondary">
                @Provider.Description
            </RadzenText>
        }

        @if (Provider.IsConfigured && Provider.ApiKeySource != null)
        {
            <RadzenText TextStyle="TextStyle.Caption" class="rz-color-secondary">
                Key from: @Provider.ApiKeySource
            </RadzenText>
        }

        <RadzenStack Orientation="Radzen.Orientation.Horizontal" Gap="0.5rem" class="rz-mt-2">
            @if (Provider.RequiresApiKey)
            {
                @if (Provider.IsConfigured)
                {
                    <RadzenButton Size="ButtonSize.Small" ButtonStyle="ButtonStyle.Primary" Variant="Radzen.Variant.Text"
                                  Text="Configure" Click="@(() => OnConfigure.InvokeAsync(Provider))" />
                    <RadzenButton Size="ButtonSize.Small" ButtonStyle="ButtonStyle.Danger" Variant="Radzen.Variant.Text"
                                  Text="Remove" Click="@(() => OnRemove.InvokeAsync(Provider))" />
                }
                else
                {
                    <RadzenButton Size="ButtonSize.Small" ButtonStyle="ButtonStyle.Primary" Variant="Radzen.Variant.Filled"
                                  Text="Configure" Click="@(() => OnConfigure.InvokeAsync(Provider))" />
                }
            }
            else
            {
                <RadzenButton Size="ButtonSize.Small" ButtonStyle="ButtonStyle.Primary" Variant="Radzen.Variant.Text"
                              Text="Configure" Click="@(() => OnConfigure.InvokeAsync(Provider))" />
                <RadzenBadge BadgeStyle="BadgeStyle.Success" Text="Ready to Use" Variant="Radzen.Variant.Text" />
            }
        </RadzenStack>
    </RadzenStack>
</RadzenCard>

@code {
    [Parameter, EditorRequired]
    public TranslationProviderDto Provider { get; set; } = null!;

    [Parameter]
    public EventCallback<TranslationProviderDto> OnConfigure { get; set; }

    [Parameter]
    public EventCallback<TranslationProviderDto> OnRemove { get; set; }

    private static string GetProviderIcon(string provider) => provider switch
    {
        "lrm" => "star",
        "google" => "g_translate",
        "deepl" => "translate",
        "openai" => "psychology",
        "claude" => "auto_awesome",
        "azuretranslator" or "azureopenai" => "cloud",
        "lingva" => "public",
        "mymemory" => "memory",
        "ollama" => "computer",
        "libretranslate" => "code",
        _ => "translate"
    };
}
