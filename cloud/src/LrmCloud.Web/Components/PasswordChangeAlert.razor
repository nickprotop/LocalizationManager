@* Password change alert - shows when user has default password that needs to be changed *@
@inject AuthenticationStateProvider AuthStateProvider
@inject NavigationManager Navigation

@if (_showAlert)
{
    <div style="background: var(--rz-warning-lighter); border: 1px solid var(--rz-warning); border-radius: 4px; padding: 0.75rem 1rem; margin-bottom: 1rem;">
        <div style="display: flex; align-items: center; justify-content: space-between; gap: 1rem; flex-wrap: wrap;">
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <RadzenIcon Icon="warning" Style="color: var(--rz-warning-dark);" />
                <span style="font-weight: 500;">Security Notice: You are using the default password. Please change it immediately.</span>
            </div>
            <button type="button" @onclick="NavigateToSettings"
                    style="background: var(--rz-warning-dark); color: white; border: none; border-radius: 4px; padding: 0.5rem 1rem; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                <RadzenIcon Icon="lock" Style="font-size: 1rem;" />
                <span>Change Password Now</span>
            </button>
        </div>
    </div>
}

@code {
    private bool _showAlert;

    protected override async Task OnInitializedAsync()
    {
        await CheckPasswordStatus();
    }

    private async Task CheckPasswordStatus()
    {
        try
        {
            var authState = await AuthStateProvider.GetAuthenticationStateAsync();
            var user = authState.User;

            if (user.Identity?.IsAuthenticated == true)
            {
                var mustChange = user.FindFirst("must_change_password")?.Value;
                _showAlert = mustChange == "true";
            }
        }
        catch
        {
            // Ignore errors
        }
    }

    private void NavigateToSettings()
    {
        Navigation.NavigateTo("/settings/profile");
    }
}
